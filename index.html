<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dasbor Interaktif Penilaian Mahasiswa</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js untuk Grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #f3f4f6;
        }
        /* Gradasi warna untuk kartu peringkat teratas */
        .card-gradient-gold { background: linear-gradient(135deg, #fef9c3, #fde047, #facc15); }
        .card-gradient-silver { background: linear-gradient(135deg, #f9fafb, #e5e7eb, #d1d5db); }
        .card-gradient-bronze { background: linear-gradient(135deg, #ffedd5, #fbbf24, #d97706); }
        
        /* Gaya untuk input pencarian */
        #searchInput:focus, #sortSelect:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        /* Gaya untuk tombol filter nilai yang aktif */
        .filter-btn-active {
            background-color: #2563eb;
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Animasi untuk modal */
        .modal-enter { opacity: 0; transform: scale(0.95) translateY(10px); }
        .modal-enter-active { opacity: 1; transform: scale(1) translateY(0); transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1); }
        .modal-leave { opacity: 1; transform: scale(1) translateY(0); }
        .modal-leave-active { opacity: 0; transform: scale(0.95) translateY(10px); transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Animasi staggered untuk kartu */
        .card-item {
            opacity: 0;
            transform: translateY(20px);
            animation: card-fade-in 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes card-fade-in {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 tracking-tight">Dasbor Penilaian Mahasiswa</h1>
            <p class="mt-3 text-lg text-gray-600 max-w-2xl mx-auto">Analisis, Visualisasi, dan Peringkat Kinerja Mahasiswa secara Interaktif.</p>
        </header>

        <!-- Ringkasan & Visualisasi -->
        <section class="mb-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Ringkasan Statistik</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg"><span class="text-gray-600 font-medium">Total Mahasiswa</span><span id="total-students" class="font-bold text-lg text-blue-600">0</span></div>
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg"><span class="text-gray-600 font-medium">Rata-rata Nilai</span><span id="average-score" class="font-bold text-lg text-green-600">0.00</span></div>
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg"><span class="text-gray-600 font-medium">Nilai Tertinggi</span><span id="highest-score" class="font-bold text-lg text-amber-600">0.00</span></div>
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg"><span class="text-gray-600 font-medium">Nilai Terendah</span><span id="lowest-score" class="font-bold text-lg text-red-600">0.00</span></div>
                </div>
            </div>
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Distribusi Nilai Huruf</h2>
                <div class="relative h-56 md:h-64"><canvas id="grade-chart"></canvas></div>
            </div>
        </section>

        <!-- Kontrol Pencarian, Filter, dan Pengurutan -->
        <div class="mb-8 p-4 bg-white rounded-xl shadow-lg border border-gray-200 sticky top-4 z-20">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">
                 <div class="relative md:col-span-2">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg></div>
                    <input type="text" id="searchInput" placeholder="Cari nama atau NIM..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none transition">
                </div>
                <div class="md:col-span-2"><div id="grade-filters" class="flex items-center gap-2 flex-wrap"></div></div>
                <div class="md:col-span-1">
                    <select id="sortSelect" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none transition">
                        <option value="rank">Urutkan: Peringkat</option>
                        <option value="name-asc">Urutkan: Nama (A-Z)</option>
                        <option value="name-desc">Urutkan: Nama (Z-A)</option>
                        <option value="score-desc">Urutkan: Nilai Tertinggi</option>
                        <option value="score-asc">Urutkan: Nilai Terendah</option>
                    </select>
                </div>
            </div>
        </div>

        <main id="leaderboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></main>
        
        <div id="no-results" class="text-center p-16 col-span-full hidden rounded-lg bg-gray-100">
            <p class="text-2xl font-semibold text-gray-700">Hasil tidak ditemukan</p>
            <p class="text-gray-500 mt-2">Coba sesuaikan filter atau kata kunci pencarian Anda.</p>
        </div>

        <footer class="text-center mt-12 text-sm text-gray-500"><p>&copy; 2025 Dasbor Penilaian Mahasiswa. Dibuat secara dinamis.</p></footer>
    </div>

    <!-- Modal untuk Detail Mahasiswa -->
    <!-- PERBAIKAN: Menambahkan `overflow-y-auto` untuk scrolling dan `max-h-screen` untuk membatasi tinggi -->
    <div id="student-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal-leave overflow-y-auto" onclick="closeModal()">
        <!-- PERBAIKAN: Menghapus `onclick` dari sini agar klik di konten tidak menutup modal -->
        <div id="modal-content-wrapper" class="w-full max-w-lg mx-auto my-8">
             <div id="modal-content" class="bg-gray-100 rounded-2xl shadow-2xl transform transition-all" onclick="event.stopPropagation()">
                <!-- Konten modal akan diisi oleh Javascript -->
            </div>
        </div>
    </div>

    <script>
        // --- DATA MENTAH (DIPERBARUI) ---
        const studentRawData = `Rangga Adriansyah 	2131232005	4.6	4.7	6.9	5	20	92	94	69	100	71.9	B
Upi Lutfiah 	2231231961	5	5	8.3	5	0	100	100	83	100	98.3	A
Roup Adifurohim	2131231989	4.8	4	3	3	0	96	80	30	60	77.4	AB
Muhamad Mujahid 	2131231960	4.6	4.2	8	3	0	92	84	80	60	82	AB
Siti Khodijah Rizqyah 	2231231971	4.6	4.1	7.8	3	0	92	82	78	60	81.2	AB
Siti Laela Norhikmah	2231231962	5	4.8	8.3	5	0	100	96	83	100	97.1	A
Nadiawati 	2231231951	5	4.7	6.7	5	0	100	94	67	100	94.9	A
Risma Yulianti 	2231231949	5	4.7	8.2	5	0	100	94	82	100	96.4	A
Atu Hayatun Toyibah	2131232007	4.6	4.9	9	5	1	92	98	90	100	94.2	A
Rahma Ainunnisa 	2231231968	4.3	4.7	8.5	5	0	86	94	85	100	91.1	A
Muhammad Afrizal 	2131231972	5	5	9.4	5	1	100	100	94	100	98.4	A
Sella Aulia	2231231988	5	4.7	8.6	5	0	100	94	86	100	96.8	A
Rina Rosdiana	2231231948	5	5	9.8	5	0	100	100	98	100	99.8	A
Kiki Sri Utari	2231231952	4.3	4.3	9.5	5	0	86	86	95	100	89.7	A
Anita sari	2231231973	4.3	4.3	9.5	3.7	0	86	86	95	74	84.5	AB
Sandy Surya Ardhi	2131231946	4.3	4.3	8.4	3	1	86	86	84	60	79.6	AB
Nida Maulida	2231231967	4.3	4.3	9.5	3.7	0	86	86	95	74	84.5	AB
Vadila Vatriatun Nada 	2231231947	4.6	3.9	7.8	3	0	92	78	78	60	80	AB
M. Ilham Arifin	2131231966	4.6	4.4	7.8	3	0	92	88	78	60	83	AB`;

        // --- Variabel Global & Elemen DOM ---
        let allStudentData = [];
        let filters = { searchTerm: '', grade: 'All', sortBy: 'rank' };
        let gradeChart = null;

        const leaderboardContainer = document.getElementById('leaderboard');
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const gradeFiltersContainer = document.getElementById('grade-filters');
        const noResultsDiv = document.getElementById('no-results');
        const studentModal = document.getElementById('student-modal');
        const modalContent = document.getElementById('modal-content');

        // --- Fungsi Bantuan ---
        const getInitials = (name) => (name.match(/\b\w/g) || []).join('').toUpperCase();
        const capitalize = (s) => s.toLowerCase().replace(/\b./g, c => c.toUpperCase());

        function getGradeBadgeClasses(grade) {
            const colors = {
                'A':  'bg-amber-100 text-amber-800 border-amber-400',  // Gold
                'AB': 'bg-lime-100 text-lime-800 border-lime-400',
                'B':  'bg-green-100 text-green-800 border-green-400',
                'BC': 'bg-teal-100 text-teal-800 border-teal-400',
                'C':  'bg-sky-100 text-sky-800 border-sky-400',
                'D':  'bg-orange-100 text-orange-800 border-orange-400',
                'E':  'bg-red-100 text-red-800 border-red-400',        // Red
                'default': 'bg-gray-100 text-gray-800 border-gray-300'
            };
            return colors[grade] || colors['default'];
        }
        
        // --- Fungsi Utama ---
        function parseAndProcessData() {
            const rows = studentRawData.trim().split('\n');
            const parsedData = rows.map(row => {
                const cols = row.split('\t').map(c => c.trim());
                const toFloatOrNull = (val) => (val && !isNaN(parseFloat(val))) ? parseFloat(val) : null;
                
                const name = capitalize(cols[0] || "Tanpa Nama");
                const nim = cols[1] || "Tanpa NIM";
                
                return {
                    name,
                    nim,
                    photoUrl: `./${nim}.jpg`,
                    scores: {
                        "Konten": toFloatOrNull(cols[2]), "Delivery": toFloatOrNull(cols[3]),
                        "Waktu": toFloatOrNull(cols[4]), "Tanya Jawab": toFloatOrNull(cols[5]),
                        "Kepatuhan": toFloatOrNull(cols[6]), "N-Pres": toFloatOrNull(cols[7]),
                        "N-Deliv": toFloatOrNull(cols[8]), "N-Waktu": toFloatOrNull(cols[9]),
                        "N-Materi": toFloatOrNull(cols[10]),
                    },
                    finalScore: toFloatOrNull(cols[11]),
                    letterGrade: cols[12] || "N/A",
                    personalNote: "Mahasiswa menunjukkan partisipasi aktif selama periode penilaian. Perlu peningkatan pada manajemen waktu presentasi."
                };
            }).filter(s => s.finalScore !== null);

            const sortedByScore = [...parsedData].sort((a, b) => b.finalScore - a.finalScore);
            allStudentData = parsedData.map(student => ({
                ...student,
                rank: sortedByScore.findIndex(s => s.nim === student.nim) + 1
            }));
        }

        function displayLeaderboard(students) {
            leaderboardContainer.innerHTML = '';
            noResultsDiv.classList.toggle('hidden', students.length > 0);
            
            students.forEach((student, index) => {
                let cardBgClass = 'bg-white hover:bg-gray-50';
                let textColor = 'text-gray-800';
                const isRankSort = filters.sortBy === 'rank';
                
                if (isRankSort && index < 3) {
                    if (index === 0) { cardBgClass = 'card-gradient-gold'; textColor = 'text-yellow-900'; }
                    else if (index === 1) { cardBgClass = 'card-gradient-silver'; textColor = 'text-gray-900'; }
                    else if (index === 2) { cardBgClass = 'card-gradient-bronze'; textColor = 'text-orange-900'; }
                }
                
                const card = document.createElement('div');
                card.className = `card-item transform hover:-translate-y-1.5 transition-all duration-300 ease-in-out ${cardBgClass} rounded-xl shadow-lg overflow-hidden border border-gray-200 cursor-pointer`;
                card.style.animationDelay = `${index * 50}ms`;
                card.innerHTML = `
                    <div class="p-5 ${textColor}">
                        <div class="flex justify-between items-start mb-4">
                             <div class="font-bold text-2xl opacity-70">#${student.rank}</div>
                             <div class="text-xs font-semibold px-2 py-1 rounded-full inline-block ${getGradeBadgeClasses(student.letterGrade)} border">
                                <strong>${student.letterGrade}</strong>
                             </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <img src="${student.photoUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x400/EBF4FF/76A9EA?text=${getInitials(student.name)}';" alt="Foto ${student.name}" class="w-16 h-16 rounded-full object-cover border-4 border-white/50 shadow-md flex-shrink-0 bg-gray-200">
                            <div class="flex-grow min-w-0">
                                <h3 class="font-bold text-lg truncate" title="${student.name}">${student.name}</h3>
                                <p class="text-sm opacity-90">NIM: ${student.nim}</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-current border-opacity-20 text-right">
                            <p class="text-sm font-medium opacity-80">Nilai Akhir</p>
                            <p class="font-extrabold text-4xl">${student.finalScore.toFixed(2)}</p>
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => openModal(student.nim));
                leaderboardContainer.appendChild(card);
            });
        }
        
        function calculateSummaryAndRenderChart() {
            const totalStudents = allStudentData.length;
            const totalScore = allStudentData.reduce((sum, s) => sum + s.finalScore, 0);
            const averageScore = totalStudents > 0 ? (totalScore / totalStudents) : 0;
            const scores = allStudentData.map(s => s.finalScore);
            const highestScore = totalStudents > 0 ? Math.max(...scores) : 0;
            const lowestScore = totalStudents > 0 ? Math.min(...scores) : 0;

            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('average-score').textContent = averageScore.toFixed(2);
            document.getElementById('highest-score').textContent = highestScore.toFixed(2);
            document.getElementById('lowest-score').textContent = lowestScore.toFixed(2);

            const gradeCounts = allStudentData.reduce((acc, student) => {
                acc[student.letterGrade] = (acc[student.letterGrade] || 0) + 1;
                return acc;
            }, {});

            const gradeOrder = ['A', 'AB', 'B', 'BC', 'C', 'D', 'E'];
            const sortedGrades = Object.keys(gradeCounts).sort((a, b) => gradeOrder.indexOf(a) - gradeOrder.indexOf(b));
            
            renderChart(sortedGrades, sortedGrades.map(grade => gradeCounts[grade]));
            renderGradeFilters(sortedGrades);
        }
        
        function renderChart(labels, data) {
            const ctx = document.getElementById('grade-chart').getContext('2d');
            if (gradeChart) gradeChart.destroy();
            const backgroundColors = labels.map(label => getGradeBadgeClasses(label).split(' ')[0].replace('bg-', 'bg-') .replace('-100', '-300'));
            gradeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Jumlah Mahasiswa', data: data,
                        backgroundColor: backgroundColors.map(c => c.replace('border-', 'bg-')),
                        borderColor: backgroundColors.map(c => c.replace('bg-', 'border-')),
                        borderWidth: 1, borderRadius: 5, hoverBackgroundColor: backgroundColors.map(c => c.replace('bg-', 'bg-').replace('-100', '-400'))
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }, plugins: { legend: { display: false } } }
            });
        }
        
        function renderGradeFilters(grades) {
            gradeFiltersContainer.innerHTML = ['All', ...grades].map(grade => `
                <button data-grade="${grade}" class="grade-filter-btn px-3 py-1 text-sm rounded-md transition-all duration-200 ${grade === 'All' ? 'filter-btn-active' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}">${grade}</button>
            `).join('');
        }

        function updateView() {
            let filteredData = allStudentData.filter(student => 
                (student.name.toLowerCase().includes(filters.searchTerm) || student.nim.includes(filters.searchTerm)) &&
                (filters.grade === 'All' || student.letterGrade === filters.grade)
            );
            switch (filters.sortBy) {
                case 'name-asc': filteredData.sort((a, b) => a.name.localeCompare(b.name)); break;
                case 'name-desc': filteredData.sort((a, b) => b.name.localeCompare(a.name)); break;
                case 'score-asc': filteredData.sort((a, b) => a.finalScore - b.finalScore); break;
                case 'score-desc': filteredData.sort((a, b) => b.finalScore - a.finalScore); break;
                case 'rank': default: filteredData.sort((a, b) => a.rank - b.rank); break;
            }
            displayLeaderboard(filteredData);
        }

        function openModal(nim) {
            const student = allStudentData.find(s => s.nim === nim);
            if (!student) return;

            // PERBAIKAN: Konten modal sekarang di-render di dalam #modal-content
            modalContent.innerHTML = `
                <div class="relative">
                    <div class="w-full h-28 ${getGradeBadgeClasses(student.letterGrade).split(' ')[0].replace('-100', '-200')} rounded-t-2xl"></div>
                    <div class="absolute top-16 left-1/2 -translate-x-1/2">
                        <img src="${student.photoUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x400/EBF4FF/76A9EA?text=${getInitials(student.name)}';" alt="Foto ${student.name}" class="w-28 h-28 rounded-full object-cover border-4 border-gray-100 shadow-lg bg-gray-300">
                    </div>
                </div>
                <div class="p-6 sm:p-8 pt-20 text-center">
                    <h2 class="text-2xl font-bold text-gray-900">${student.name}</h2>
                    <p class="text-sm text-gray-500">NIM: ${student.nim}</p>
                    <div class="mt-4 inline-flex flex-wrap justify-center items-center gap-4 rounded-lg p-4 bg-white border">
                        <div>
                           <p class="text-sm text-gray-600 font-medium">Peringkat</p>
                           <p class="text-3xl font-bold text-blue-600">#${student.rank}</p>
                        </div>
                        <div class="border-l h-10 border-gray-200"></div>
                        <div class="text-right">
                           <p class="text-sm text-gray-600 font-medium">Nilai Akhir</p>
                           <p class="text-3xl font-bold text-blue-600">${student.finalScore.toFixed(2)}</p>
                        </div>
                         <div class="border-l h-10 border-gray-200"></div>
                         <div class="text-right">
                           <p class="text-sm text-gray-600 font-medium">Nilai Huruf</p>
                           <div class="text-3xl font-bold px-3 py-1 mt-1 rounded-lg inline-block ${getGradeBadgeClasses(student.letterGrade)} border">
                                ${student.letterGrade}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 sm:px-8 pb-8 space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-gray-700 text-center">Rincian Komponen Nilai</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-center bg-white p-4 rounded-lg border">
                            ${Object.entries(student.scores).map(([key, value]) => `
                                <div class="bg-gray-50 p-3 rounded-lg border">
                                    <p class="text-xs font-medium text-gray-500 uppercase">${key}</p>
                                    <p class="text-xl font-semibold text-gray-800">${value !== null ? value : '-'}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-gray-700 text-center">Catatan Personal Penilai</h3>
                        <div class="bg-white p-4 rounded-lg border text-gray-600 text-sm italic">
                           "${student.personalNote || 'Tidak ada catatan.'}"
                        </div>
                    </div>
                </div>
            `;
            studentModal.classList.remove('hidden');
            // Menerapkan animasi pada elemen pembungkus konten, bukan modal utama
            document.getElementById('modal-content').classList.add('modal-enter', 'modal-enter-active');
        }
        
        function closeModal() {
            const modalContentDiv = document.getElementById('modal-content');
            modalContentDiv.classList.remove('modal-enter-active');
            modalContentDiv.classList.add('modal-leave-active');
            
            setTimeout(() => {
                studentModal.classList.add('hidden');
                modalContentDiv.classList.remove('modal-leave-active', 'modal-enter');
            }, 200);
        }
        
        // --- Inisialisasi & Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            parseAndProcessData();
            calculateSummaryAndRenderChart();
            updateView();
            
            searchInput.addEventListener('input', (e) => { filters.searchTerm = e.target.value.toLowerCase(); updateView(); });
            sortSelect.addEventListener('change', (e) => { filters.sortBy = e.target.value; updateView(); });
            gradeFiltersContainer.addEventListener('click', (e) => {
                if (e.target.matches('.grade-filter-btn')) {
                    filters.grade = e.target.dataset.grade;
                    document.querySelectorAll('.grade-filter-btn').forEach(btn => btn.classList.remove('filter-btn-active'));
                    e.target.classList.add('filter-btn-active');
                    updateView();
                }
            });
        });
    </script>

</body>
</html>
